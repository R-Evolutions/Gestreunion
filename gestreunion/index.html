<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="GestRéunion - Outil de gestion des réunions d'équipe, de la préparation au suivi des tâches">
  <meta name="theme-color" content="#4f46e5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>GestRéunion - Gestion des réunions d'équipe</title>
  <link rel="manifest" href="/gestreunion/manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="/gestreunion/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/gestreunion/icons/icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .pulse-rec { animation: pulseRec 1.5s infinite; }
    @keyframes pulseRec { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .wave-bar { animation: wave 1.2s ease-in-out infinite; }
    @keyframes wave { 0%, 100% { height: 8px; } 50% { height: 28px; } }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
    textarea { resize: vertical; }
    #loading { display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; gap: 16px; }
    #loading .spinner { width: 40px; height: 40px; border: 3px solid #e2e8f0; border-top-color: #4f46e5; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="root">
    <div id="loading">
      <div class="spinner"></div>
      <p style="color: #6b7280; font-size: 14px;">Chargement de GestRéunion...</p>
    </div>
  </div>

  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- React Production -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <!-- Application (pre-compiled, no Babel needed) -->
  <script>var App=(()=>{var{useState:N,useEffect:L,useCallback:fe,useRef:j,useMemo:ve}=React,y=()=>crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)}),Q=e=>new Date(e).toLocaleDateString("fr-BE",{day:"2-digit",month:"2-digit",year:"numeric"}),U=e=>{let r=Math.floor(e/60),d=e%60;return`${String(r).padStart(2,"0")}:${String(d).padStart(2,"0")}`},ee=()=>new Date().toLocaleString("fr-BE"),P="gestreunion_v2",te="https://moguqzbjopnbittphqyq.supabase.co",ae="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZ3VxemJqb3BuYml0dHBocXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTY4NzcsImV4cCI6MjA4NjMzMjg3N30.n6UE0NPxskB228H2YEjdWox9BHVfY8XGdoIUu5umICA",x=typeof window<"u"&&window.supabase?window.supabase.createClient(te,ae):null,V=[{id:0,key:"preparation",label:"Pr\xE9paration",icon:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"},{id:1,key:"recording",label:"Enregistrement",icon:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},{id:2,key:"transcription",label:"Transcription",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},{id:3,key:"analysis",label:"Analyse IA",icon:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"},{id:4,key:"validation",label:"Validation",icon:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},{id:5,key:"tasks",label:"Suivi des t\xE2ches",icon:"M4 6h16M4 10h16M4 14h16M4 18h16"}],G=[{value:"haute",label:"Haute",color:"bg-red-100 text-red-700"},{value:"moyenne",label:"Moyenne",color:"bg-amber-100 text-amber-700"},{value:"normale",label:"Normale",color:"bg-blue-100 text-blue-700"},{value:"basse",label:"Basse",color:"bg-gray-100 text-gray-600"}],D=[{value:"non_commence",label:"Non commenc\xE9",color:"bg-gray-100 text-gray-700"},{value:"en_cours",label:"En cours",color:"bg-blue-100 text-blue-700"},{value:"termine",label:"Termin\xE9",color:"bg-emerald-100 text-emerald-700"},{value:"bloque",label:"Bloqu\xE9",color:"bg-red-100 text-red-700"}],B={async loadLatestMeeting(){if(!x)return null;let{data:e,error:r}=await x.from("meetings").select("*").order("updated_at",{ascending:!1}).limit(1);return r||!e||e.length===0?null:B.loadMeetingById(e[0].id)},async loadMeetingById(e){if(!x)return null;let{data:r,error:d}=await x.from("meetings").select("*").eq("id",e).single();if(d||!r)return null;let[{data:u},{data:p},{data:m},{data:a},{data:o},{data:b}]=await Promise.all([x.from("template_sections").select("*").eq("meeting_id",e).order("sort_order"),x.from("agenda_items").select("*").eq("meeting_id",e).order("sort_order"),x.from("audio_recordings").select("*").eq("meeting_id",e).order("created_at",{ascending:!1}).limit(1),x.from("transcription_segments").select("*").eq("meeting_id",e).order("sort_order"),x.from("analyses").select("*").eq("meeting_id",e),x.from("tasks").select("*").eq("meeting_id",e)]),h=(o||[]).map(n=>n.id),I=[];if(h.length>0){let{data:n}=await x.from("validations").select("*").in("analysis_id",h);I=n||[]}let k=m&&m.length>0?m[0]:null,v=k?{status:k.status==="ready"?"done":k.status||"idle",duration:k.duration_seconds||0,filename:k.file_name||""}:{status:"idle",duration:0,filename:""},g={};return I.forEach(n=>{g[n.agenda_item_id]={status:n.status,comment:n.comment||"",validatedAt:n.validated_at,validatedBy:n.validated_by||"Utilisateur"}}),{id:r.id,title:r.title||"",date:r.date||new Date().toISOString().split("T")[0],location:r.location||"",participants:r.participants||"",currentPhase:r.current_phase||0,rgpdConsent:r.rgpd_consent||!1,template:{sections:(u||[]).map(n=>({id:n.id,name:n.name,enabled:n.enabled}))},agendaItems:(p||[]).map(n=>({id:n.id,title:n.title,description:n.description||"",priority:n.priority||"normale",estimatedTime:n.estimated_time||15,documents:n.documents||"",team:n.team||""})),recording:v,transcription:{status:a&&a.length>0?"done":"idle",segments:(a||[]).map(n=>({speaker:n.speaker,text:n.text,time:n.start_time}))},analyses:(o||[]).map(n=>({id:n.id,agendaItemId:n.agenda_item_id,shortSummary:n.short_summary||"",detailedSummary:n.detailed_summary||"",consensus:n.consensus||[],divergences:n.divergences||[],decisions:n.decisions||[],ambiguities:n.ambiguities||[],formalText:n.formal_text||""})),validations:g,tasks:(b||[]).map(n=>({id:n.id,task:n.title,description:n.description||"",responsible:n.responsible||"",expectedOutput:n.expected_output||"",deadline:n.deadline||"",agendaItemId:n.agenda_item_id,status:n.status||"non_commence"}))}},async saveMeeting(e,r){if(!x)return;let d=e.id,{error:u}=await x.from("meetings").upsert({id:d,title:e.title||"",date:e.date||new Date().toISOString().split("T")[0],location:e.location||"",participants:e.participants||"",current_phase:r,rgpd_consent:e.rgpdConsent||!1,status:V[r]?.key||"preparation"});if(u){console.error("Save meeting error:",u);return}await x.from("tasks").delete().eq("meeting_id",d),await x.from("transcription_segments").delete().eq("meeting_id",d),await x.from("audio_recordings").delete().eq("meeting_id",d),await x.from("template_sections").delete().eq("meeting_id",d);let{data:p}=await x.from("analyses").select("id").eq("meeting_id",d);p&&p.length>0&&await x.from("validations").delete().in("analysis_id",p.map(a=>a.id)),await x.from("analyses").delete().eq("meeting_id",d),await x.from("agenda_items").delete().eq("meeting_id",d),e.template?.sections?.length>0&&await x.from("template_sections").insert(e.template.sections.map((a,o)=>({id:a.id,meeting_id:d,name:a.name,enabled:a.enabled!==!1,sort_order:o}))),e.agendaItems?.length>0&&await x.from("agenda_items").insert(e.agendaItems.map((a,o)=>({id:a.id,meeting_id:d,title:a.title,description:a.description||"",priority:a.priority||"normale",estimated_time:a.estimatedTime||15,documents:a.documents||"",team:a.team||"",sort_order:o}))),e.recording?.status==="done"&&await x.from("audio_recordings").insert({id:y(),meeting_id:d,file_path:"",file_name:e.recording.filename||"",duration_seconds:e.recording.duration||0,status:"ready"}),e.transcription?.segments?.length>0&&await x.from("transcription_segments").insert(e.transcription.segments.map((a,o)=>({id:y(),meeting_id:d,speaker:a.speaker||"Inconnu",text:a.text,start_time:a.time||"00:00",sort_order:o}))),e.analyses?.length>0&&await x.from("analyses").insert(e.analyses.map(a=>({id:a.id,meeting_id:d,agenda_item_id:a.agendaItemId,short_summary:a.shortSummary||"",detailed_summary:a.detailedSummary||"",consensus:a.consensus||[],divergences:a.divergences||[],decisions:a.decisions||[],ambiguities:a.ambiguities||[],formal_text:a.formalText||"",status:"draft",generated_by_ai:!0})));let m=Object.entries(e.validations||{});if(m.length>0&&e.analyses?.length>0){let a=m.map(([o,b])=>{let h=e.analyses.find(I=>I.agendaItemId===o);return h?{id:y(),analysis_id:h.id,agenda_item_id:o,status:b.status,comment:b.comment||"",validated_by:b.validatedBy||"Utilisateur"}:null}).filter(Boolean);a.length>0&&await x.from("validations").insert(a)}e.tasks?.length>0&&await x.from("tasks").insert(e.tasks.map(a=>({id:a.id,meeting_id:d,agenda_item_id:a.agendaItemId||null,title:a.task||"",description:a.description||"",responsible:a.responsible||"",expected_output:a.expectedOutput||"",deadline:a.deadline||null,status:a.status||"non_commence"})))},async listMeetings(){if(!x)return[];let{data:e,error:r}=await x.from("meetings").select("id, title, date, status, updated_at").order("updated_at",{ascending:!1});return r?[]:e||[]}};function $(){return{id:y(),title:"",date:new Date().toISOString().split("T")[0],location:"",participants:"",template:{sections:[{id:y(),name:"Contexte / Introduction",enabled:!0},{id:y(),name:"Points \xE0 l'ordre du jour",enabled:!0},{id:y(),name:"Synth\xE8se des \xE9changes",enabled:!0},{id:y(),name:"D\xE9cisions",enabled:!0},{id:y(),name:"T\xE2ches / Responsabilit\xE9s / \xC9ch\xE9ances",enabled:!0},{id:y(),name:"Points report\xE9s",enabled:!0},{id:y(),name:"Divers",enabled:!0}]},agendaItems:[],recording:{status:"idle",duration:0,filename:""},transcription:{status:"idle",segments:[]},analyses:[],validations:{},tasks:[],currentPhase:0,rgpdConsent:!1}}var R=[{id:"oj1",title:"Suivi des accompagnements en cours",description:"Point sur les situations individuelles suivies par les membres de l'\xE9quipe. Identification des cas n\xE9cessitant une attention particuli\xE8re ou un ajustement de la prise en charge.",estimatedTime:20,documents:"Tableau de suivi mensuel",team:"\xC9quipe compl\xE8te",priority:"haute"},{id:"oj2",title:"Organisation de la journ\xE9e portes ouvertes",description:"Planification de l'\xE9v\xE9nement annuel d'ouverture au public et aux partenaires. Discussion du programme, de la logistique et de la r\xE9partition des r\xF4les.",estimatedTime:15,documents:"Budget pr\xE9visionnel, programme provisoire",team:"\xC9quipe compl\xE8te",priority:"moyenne"},{id:"oj3",title:"R\xE9vision du protocole d'accueil des nouveaux b\xE9n\xE9ficiaires",description:"Evaluation du protocole actuel et propositions d'am\xE9lioration suite aux retours des usagers et de l'\xE9quipe.",estimatedTime:15,documents:"Protocole actuel v2.1, questionnaires de satisfaction",team:"Sophie, Fatima, Marc",priority:"haute"},{id:"oj4",title:"Plan de formation continue 2026",description:"Discussion des besoins en formation identifi\xE9s et priorisation des demandes pour le prochain semestre.",estimatedTime:10,documents:"Catalogue de formations",team:"\xC9quipe compl\xE8te",priority:"normale"}],H=[{speaker:"Sophie Martin (coordinatrice)",text:"Bonjour \xE0 tous, merci d'\xEAtre l\xE0. On d\xE9marre la r\xE9union d'\xE9quipe. Premier point : le suivi des accompagnements en cours. Marc, tu voulais faire un retour sur la situation de la famille Diallo ?",time:"00:00:15"},{speaker:"Marc Dupont (travailleur social)",text:"Oui. La situation est... elle est complexe. On a rencontr\xE9 la famille trois fois ce mois-ci. Le p\xE8re a perdu son emploi le mois dernier et la m\xE8re est en arr\xEAt maladie. Les deux enfants sont scolaris\xE9s mais l'a\xEEn\xE9 commence \xE0 d\xE9crocher. J'ai mis en place un accompagnement renforc\xE9 mais je ne suis pas certain que notre approche actuelle soit suffisante.",time:"00:00:35"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"Marc, je comprends ta pr\xE9occupation, mais je pense qu'on devrait revoir notre angle d'intervention. Quand je vois la famille dans les activit\xE9s collectives, le p\xE8re est tr\xE8s engag\xE9. Je me demande si on ne se focalise pas trop sur les difficult\xE9s sans voir les ressources de cette famille.",time:"00:01:10"},{speaker:"Marc Dupont (travailleur social)",text:"C'est vrai que le p\xE8re est pr\xE9sent aux activit\xE9s, mais \xE7a ne r\xE9sout pas le d\xE9crochage scolaire de l'a\xEEn\xE9. Il a manqu\xE9 six jours d'\xE9cole le mois dernier.",time:"00:01:30"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"Je rejoins Fatima sur l'approche par les ressources. Par contre, pour l'absent\xE9isme scolaire, il faudrait contacter le service psycho-social scolaire pour une \xE9valuation. C'est un signal d'alerte qu'on ne peut pas ignorer.",time:"00:01:42"},{speaker:"Sophie Martin (coordinatrice)",text:"OK, donc on a deux pistes : premi\xE8rement, revoir notre approche pour mieux int\xE9grer les forces de la famille. Deuxi\xE8mement, contacter le service scolaire pour l'a\xEEn\xE9. Marc, tu coordonnes \xE7a ? On fait le point la semaine prochaine.",time:"00:01:58"},{speaker:"Marc Dupont (travailleur social)",text:"D'accord, je m'en charge. Je contacte le service scolaire demain matin.",time:"00:02:12"},{speaker:"Sophie Martin (coordinatrice)",text:"Parfait. Fatima, un point rapide sur l'accompagnement de Mme Rousseau ?",time:"00:02:20"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"Oui, alors l\xE0 c'est plut\xF4t positif. Elle a repris les ateliers depuis trois semaines et elle est r\xE9guli\xE8re. L'objectif d'autonomie dans les transports avance bien. Par contre, elle exprime une anxi\xE9t\xE9 par rapport \xE0 la fin de son contrat d'accompagnement en juin.",time:"00:02:30"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"C'est un sujet qu'il faudra aborder en entretien individuel. La question de la s\xE9paration est souvent anxiog\xE8ne. Je peux la voir la semaine prochaine si n\xE9cessaire.",time:"00:02:50"},{speaker:"Sophie Martin (coordinatrice)",text:"Tr\xE8s bien Julien, c'est not\xE9. On passe au deuxi\xE8me point : la journ\xE9e portes ouvertes. Vous avez tous re\xE7u le programme provisoire ?",time:"00:03:05"},{speaker:"Marc Dupont (travailleur social)",text:"Oui, j'ai regard\xE9. La date du 15 mars convient mais le budget pr\xE9visionnel me semble serr\xE9. 500 euros pour l'ensemble, c'est peu si on veut un buffet correct et des supports de communication.",time:"00:03:20"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"Je suis d'accord avec Marc sur le budget. Par contre, on pourrait demander aux b\xE9n\xE9ficiaires de participer \xE0 l'organisation. L'an dernier, l'atelier cuisine avait propos\xE9 de g\xE9rer le buffet et \xE7a avait super bien march\xE9.",time:"00:03:38"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"Bonne id\xE9e. \xC7a valorise aussi les comp\xE9tences des personnes accompagn\xE9es. Pour les supports de communication, je connais une imprimerie sociale qui fait des tarifs r\xE9duits pour le secteur.",time:"00:03:52"},{speaker:"Sophie Martin (coordinatrice)",text:"Excellent. Donc on confirme la date du 15 mars. Marc, tu veux bien coordonner la logistique g\xE9n\xE9rale ? Fatima, tu g\xE8res la participation des b\xE9n\xE9ficiaires. Et Julien, tu te renseignes pour l'imprimerie.",time:"00:04:05"},{speaker:"Marc Dupont (travailleur social)",text:"OK pour moi. Il faudrait quand m\xEAme revoir le budget \xE0 la hausse. Je propose 750 euros.",time:"00:04:18"},{speaker:"Sophie Martin (coordinatrice)",text:"Je vais en discuter avec la direction. On reste sur 500 comme base et je reviens vers vous. Troisi\xE8me point : la r\xE9vision du protocole d'accueil.",time:"00:04:28"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"J'ai analys\xE9 les questionnaires de satisfaction et il y a un retour r\xE9current : les nouveaux b\xE9n\xE9ficiaires se sentent perdus la premi\xE8re semaine. Le protocole actuel pr\xE9voit un seul entretien d'accueil, c'est insuffisant.",time:"00:04:45"},{speaker:"Marc Dupont (travailleur social)",text:"C'est vrai. Moi je fais syst\xE9matiquement un deuxi\xE8me entretien dans la semaine, mais c'est pas pr\xE9vu dans le protocole. Et puis le document d'accueil est trop long, personne ne le lit.",time:"00:05:00"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"Il faudrait aussi penser \xE0 un parrainage entre pairs. C'est ce qui se fait dans d'autres structures et les retours sont tr\xE8s positifs. Mais attention, \xE7a demande un cadre clair pour \xE9viter les relations de d\xE9pendance.",time:"00:05:18"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"Le parrainage c'est une bonne id\xE9e mais \xE7a implique de former les parrains. C'est du travail suppl\xE9mentaire qu'il faut anticiper.",time:"00:05:32"},{speaker:"Sophie Martin (coordinatrice)",text:"Je propose qu'on cr\xE9e un groupe de travail pour r\xE9viser le protocole. Fatima et Marc, vous pourriez piloter \xE7a ? Avec Julien en appui pour le volet parrainage. Objectif : une proposition dans un mois.",time:"00:05:45"},{speaker:"Marc Dupont (travailleur social)",text:"\xC7a me va. On planifie une premi\xE8re r\xE9union la semaine prochaine.",time:"00:05:55"},{speaker:"Sophie Martin (coordinatrice)",text:"Dernier point : le plan de formation continue. J'ai re\xE7u le catalogue et il y a plusieurs formations int\xE9ressantes. Quels sont vos besoins prioritaires ?",time:"00:06:05"},{speaker:"Fatima Benali (\xE9ducatrice sp\xE9cialis\xE9e)",text:"Moi j'aimerais suivre la formation sur les outils d'\xE9valuation participative. \xC7a fait deux ans que je la demande.",time:"00:06:18"},{speaker:"Marc Dupont (travailleur social)",text:"Il y a une formation en m\xE9diation familiale qui m'int\xE9resse beaucoup, mais elle est sur cinq jours. \xC7a pose la question du remplacement.",time:"00:06:28"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"Pour ma part, il y a un s\xE9minaire sur les pratiques orient\xE9es r\xE9tablissement que j'aimerais suivre. C'est en ligne, donc pas de probl\xE8me d'absence.",time:"00:06:42"},{speaker:"Sophie Martin (coordinatrice)",text:"OK, on a trois demandes. Le budget formation est limit\xE9 cette ann\xE9e donc... je ne suis pas s\xFBre qu'on puisse tout financer. Il faudrait prioriser. Fatima, ta demande est r\xE9currente donc je la mets en priorit\xE9. Pour Marc, il faudra voir avec la direction pour le remplacement. Et Julien, comme c'est en ligne, \xE7a devrait passer sans probl\xE8me.",time:"00:06:55"},{speaker:"Marc Dupont (travailleur social)",text:"Je comprends la contrainte budg\xE9taire, mais la m\xE9diation familiale c'est vraiment un besoin sur le terrain. On a de plus en plus de situations familiales complexes.",time:"00:07:15"},{speaker:"Sophie Martin (coordinatrice)",text:"Je note ton argument Marc, c'est pertinent. Je vais d\xE9fendre les trois demandes aupr\xE8s de la direction et on verra ce qui est possible. On n'a pas de d\xE9cision d\xE9finitive aujourd'hui sur ce point. Des points divers ?",time:"00:07:28"},{speaker:"Julien Lef\xE8vre (psychologue)",text:"Juste un rappel : la supervision collective est pr\xE9vue le 20 mars. Pensez \xE0 pr\xE9parer vos situations.",time:"00:07:42"},{speaker:"Sophie Martin (coordinatrice)",text:"Merci Julien. S'il n'y a rien d'autre, on cl\xF4ture. Bonne fin de journ\xE9e \xE0 tous.",time:"00:07:50"}],O=[{agendaItemId:"oj1",shortSummary:"Discussion de deux situations : la famille Diallo (n\xE9cessite un r\xE9ajustement d'approche et un contact avec le service scolaire) et Mme Rousseau (\xE9volution positive avec une anxi\xE9t\xE9 \xE0 traiter).",detailedSummary:"L'\xE9quipe a examin\xE9 en profondeur la situation de la famille Diallo, confront\xE9e \xE0 une perte d'emploi et un arr\xEAt maladie. Marc a exprim\xE9 des doutes sur l'efficacit\xE9 de l'approche actuelle face au d\xE9crochage scolaire de l'a\xEEn\xE9 (6 jours d'absence). Fatima a propos\xE9 de r\xE9orienter l'intervention vers les ressources de la famille plut\xF4t que les difficult\xE9s. Julien a appuy\xE9 cette orientation tout en insistant sur la n\xE9cessit\xE9 de contacter le service psycho-social scolaire. Concernant Mme Rousseau, l'\xE9volution est positive mais une anxi\xE9t\xE9 de s\xE9paration est identifi\xE9e.",consensus:["L'approche par les ressources de la famille est pertinente","Le d\xE9crochage scolaire n\xE9cessite une intervention sp\xE9cifique via le service scolaire","La situation de Mme Rousseau n\xE9cessite un accompagnement psychologique pour la transition"],divergences:["Marc estime l'approche actuelle insuffisante tandis que Fatima consid\xE8re que le regard est trop centr\xE9 sur les difficult\xE9s"],decisions:["Marc contactera le service psycho-social scolaire pour l'a\xEEn\xE9 de la famille Diallo","Julien proposera un entretien \xE0 Mme Rousseau concernant l'anxi\xE9t\xE9 de fin d'accompagnement","Point de suivi pr\xE9vu la semaine prochaine pour la famille Diallo"],ambiguities:["La mani\xE8re concr\xE8te de 'revoir l'approche' n'a pas \xE9t\xE9 d\xE9taill\xE9e","Le calendrier exact pour l'entretien de Mme Rousseau reste \xE0 pr\xE9ciser"],formalText:"L'\xE9quipe a proc\xE9d\xE9 \xE0 l'examen de deux situations. Concernant la famille Diallo, un r\xE9ajustement de l'approche d'intervention est d\xE9cid\xE9, privil\xE9giant les ressources familiales. Un contact avec le service psycho-social scolaire sera \xE9tabli par M. Dupont pour traiter le d\xE9crochage scolaire de l'a\xEEn\xE9. Un suivi hebdomadaire est instaur\xE9. S'agissant de Mme Rousseau, l'\xE9volution positive est constat\xE9e. Un accompagnement psychologique sera propos\xE9 par M. Lef\xE8vre pour pr\xE9parer la fin du contrat d'accompagnement."},{agendaItemId:"oj2",shortSummary:"La date du 15 mars est confirm\xE9e pour la journ\xE9e portes ouvertes. Le budget est jug\xE9 insuffisant. Plusieurs pistes d'optimisation sont identifi\xE9es.",detailedSummary:"L'\xE9quipe a discut\xE9 de l'organisation de la journ\xE9e portes ouvertes pr\xE9vue le 15 mars. Marc a soulev\xE9 l'insuffisance du budget de 500 euros et propose de le revoir \xE0 750 euros. Fatima a sugg\xE9r\xE9 d'impliquer les b\xE9n\xE9ficiaires dans l'organisation. Julien a propos\xE9 de contacter une imprimerie sociale pour r\xE9duire les co\xFBts de communication.",consensus:["La date du 15 mars est valid\xE9e par tous","L'implication des b\xE9n\xE9ficiaires est salu\xE9e unanimement","Le budget actuel est jug\xE9 insuffisant"],divergences:[],decisions:["Date confirm\xE9e : 15 mars","Marc coordonne la logistique g\xE9n\xE9rale","Fatima organise la participation des b\xE9n\xE9ficiaires","Julien se renseigne sur l'imprimerie sociale","Sophie porte la demande de revalorisation budg\xE9taire aupr\xE8s de la direction"],ambiguities:["Le budget d\xE9finitif reste en attente de validation par la direction (500 ou 750 euros)","Le programme d\xE9taill\xE9 n'a pas \xE9t\xE9 discut\xE9"],formalText:"La journ\xE9e portes ouvertes est confirm\xE9e au 15 mars. La coordination logistique est assur\xE9e par M. Dupont. Mme Benali organisera la participation des b\xE9n\xE9ficiaires. M. Lef\xE8vre contactera une imprimerie sociale. La coordinatrice soumettra une demande de revalorisation du budget \xE0 la direction."},{agendaItemId:"oj3",shortSummary:"Le protocole d'accueil actuel est jug\xE9 insuffisant. Un groupe de travail est cr\xE9\xE9 pour le r\xE9viser avec un objectif de proposition dans un mois.",detailedSummary:"L'analyse des questionnaires de satisfaction r\xE9v\xE8le un sentiment de perte de rep\xE8res chez les nouveaux b\xE9n\xE9ficiaires. Fatima a identifi\xE9 le probl\xE8me central : un seul entretien d'accueil est pr\xE9vu. Marc a confirm\xE9 cette lacune. Julien a propos\xE9 un syst\xE8me de parrainage entre pairs, avec des r\xE9serves sur le cadrage n\xE9cessaire.",consensus:["Le protocole actuel est insuffisant","Un deuxi\xE8me entretien d'accueil est n\xE9cessaire","Le document d'accueil doit \xEAtre simplifi\xE9"],divergences:["L'id\xE9e du parrainage est accueillie positivement mais des r\xE9serves sont exprim\xE9es sur sa faisabilit\xE9"],decisions:["Cr\xE9ation d'un groupe de travail pilot\xE9 par Fatima et Marc, avec Julien en appui","Objectif : proposition de nouveau protocole dans un mois","Premi\xE8re r\xE9union du groupe de travail la semaine prochaine"],ambiguities:["La question du parrainage entre pairs reste ouverte","Le format exact du nouveau document d'accueil n'a pas \xE9t\xE9 discut\xE9"],formalText:"L'\xE9quipe constate l'insuffisance du protocole d'accueil actuel sur base des retours des usagers. Un groupe de travail compos\xE9 de Mme Benali et M. Dupont, avec l'appui de M. Lef\xE8vre, est mandat\xE9 pour \xE9laborer une proposition de r\xE9vision. Le d\xE9lai de production est fix\xE9 \xE0 un mois."},{agendaItemId:"oj4",shortSummary:"Trois demandes de formation identifi\xE9es. Aucune d\xE9cision d\xE9finitive en raison des contraintes budg\xE9taires.",detailedSummary:"Trois besoins de formation ont \xE9t\xE9 exprim\xE9s : Fatima souhaite une formation sur les outils d'\xE9valuation participative (demande r\xE9currente), Marc est int\xE9ress\xE9 par une formation en m\xE9diation familiale de cinq jours, et Julien envisage un s\xE9minaire en ligne. Sophie a indiqu\xE9 que le budget est limit\xE9.",consensus:["Les trois demandes sont jug\xE9es pertinentes par l'\xE9quipe"],divergences:["Tension entre les contraintes budg\xE9taires et les besoins exprim\xE9s"],decisions:[],ambiguities:["Aucune d\xE9cision d\xE9finitive : toutes les demandes sont soumises \xE0 validation par la direction","Le budget formation disponible n'a pas \xE9t\xE9 pr\xE9cis\xE9"],formalText:"[ATTENTION \u2013 Analyse IA : aucune d\xE9cision formelle n'a \xE9t\xE9 prise sur ce point.] Trois demandes de formation ont \xE9t\xE9 formul\xE9es. La coordinatrice soumettra l'ensemble des demandes \xE0 la direction pour arbitrage budg\xE9taire."}],Y=[{id:y(),task:"Contacter le service psycho-social scolaire pour l'a\xEEn\xE9 de la famille Diallo",responsible:"Marc Dupont",description:"Prise de contact pour \xE9valuation de l'absent\xE9isme scolaire",expectedOutput:"Rendez-vous fix\xE9 ou retour \xE9crit",deadline:"2026-02-11",agendaItemId:"oj1",status:"non_commence"},{id:y(),task:"Proposer un entretien \xE0 Mme Rousseau",responsible:"Julien Lef\xE8vre",description:"Entretien sur l'anxi\xE9t\xE9 li\xE9e \xE0 la fin du contrat d'accompagnement",expectedOutput:"Entretien r\xE9alis\xE9, note de suivi",deadline:"2026-02-17",agendaItemId:"oj1",status:"non_commence"},{id:y(),task:"Coordonner la logistique de la journ\xE9e portes ouvertes",responsible:"Marc Dupont",description:"Planification globale : salle, mat\xE9riel, programme",expectedOutput:"Plan logistique d\xE9taill\xE9",deadline:"2026-03-01",agendaItemId:"oj2",status:"non_commence"},{id:y(),task:"Organiser la participation des b\xE9n\xE9ficiaires",responsible:"Fatima Benali",description:"Mobiliser l'atelier cuisine et identifier d'autres contributions",expectedOutput:"Liste des participants et contributions",deadline:"2026-02-28",agendaItemId:"oj2",status:"non_commence"},{id:y(),task:"Se renseigner sur l'imprimerie sociale",responsible:"Julien Lef\xE8vre",description:"Obtenir un devis pour les supports de communication",expectedOutput:"Devis comparatif",deadline:"2026-02-20",agendaItemId:"oj2",status:"non_commence"},{id:y(),task:"Demander revalorisation budget portes ouvertes",responsible:"Sophie Martin",description:"Soumettre la demande de passage de 500 \xE0 750 euros",expectedOutput:"R\xE9ponse de la direction",deadline:"2026-02-14",agendaItemId:"oj2",status:"non_commence"},{id:y(),task:"Premi\xE8re r\xE9union du groupe de travail protocole d'accueil",responsible:"Fatima Benali, Marc Dupont",description:"Lancer la r\xE9vision du protocole d'accueil",expectedOutput:"Compte-rendu, plan de travail",deadline:"2026-02-17",agendaItemId:"oj3",status:"non_commence"},{id:y(),task:"Soumettre les demandes de formation \xE0 la direction",responsible:"Sophie Martin",description:"Pr\xE9senter les trois demandes avec argumentation",expectedOutput:"Arbitrage budg\xE9taire de la direction",deadline:"2026-02-21",agendaItemId:"oj4",status:"non_commence"}];function E({children:e,color:r="bg-gray-100 text-gray-700"}){return React.createElement("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r}`},e)}function C({title:e,children:r,actions:d,className:u="",warning:p=!1}){return React.createElement("div",{className:`bg-white rounded-xl shadow-sm border ${p?"border-amber-300":"border-gray-200"} ${u}`},(e||d)&&React.createElement("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100"},e&&React.createElement("h3",{className:"text-base font-semibold text-gray-800"},e),d&&React.createElement("div",{className:"flex gap-2"},d)),React.createElement("div",{className:"p-5"},r))}function w({children:e,variant:r="secondary",size:d="md",onClick:u,disabled:p,className:m="",type:a="button"}){let o="inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",b={primary:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500",secondary:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-indigo-500",success:"bg-emerald-600 text-white hover:bg-emerald-700 focus:ring-emerald-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",warning:"bg-amber-500 text-white hover:bg-amber-600 focus:ring-amber-500",ghost:"text-gray-600 hover:bg-gray-100 focus:ring-gray-300"},h={sm:"px-3 py-1.5 text-xs gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-5 py-2.5 text-base gap-2"};return React.createElement("button",{type:a,className:`${o} ${b[r]} ${h[d]} ${m}`,onClick:u,disabled:p},e)}function _({label:e,value:r,onChange:d,type:u="text",placeholder:p="",required:m=!1,className:a=""}){return React.createElement("div",{className:a},e&&React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},e,m&&React.createElement("span",{className:"text-red-500 ml-1"},"*")),React.createElement("input",{type:u,value:r,onChange:o=>d(o.target.value),placeholder:p,required:m,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"}))}function A({label:e,value:r,onChange:d,rows:u=3,placeholder:p="",className:m=""}){return React.createElement("div",{className:m},e&&React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},e),React.createElement("textarea",{value:r,onChange:a=>d(a.target.value),rows:u,placeholder:p,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"}))}function z({label:e,value:r,onChange:d,options:u,className:p=""}){return React.createElement("div",{className:p},e&&React.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},e),React.createElement("select",{value:r,onChange:m=>d(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition bg-white"},u.map(m=>React.createElement("option",{key:m.value,value:m.value},m.label))))}function se({value:e,max:r,label:d}){let u=r>0?Math.round(e/r*100):0;return React.createElement("div",{className:"w-full"},d&&React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mb-1"},React.createElement("span",null,d),React.createElement("span",null,u,"%")),React.createElement("div",{className:"w-full bg-gray-200 rounded-full h-2"},React.createElement("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:`${u}%`}})))}function M({type:e="info",children:r}){return React.createElement("div",{className:`border rounded-lg px-4 py-3 text-sm ${{info:"bg-blue-50 border-blue-200 text-blue-800",warning:"bg-amber-50 border-amber-200 text-amber-800",success:"bg-emerald-50 border-emerald-200 text-emerald-800",danger:"bg-red-50 border-red-200 text-red-800"}[e]}`},r)}function K({isOpen:e,onClose:r,title:d,children:u,wide:p=!1}){return e?React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:r},React.createElement("div",{className:"fixed inset-0 bg-black/40"}),React.createElement("div",{className:`relative bg-white rounded-2xl shadow-xl ${p?"max-w-3xl":"max-w-lg"} w-full max-h-[85vh] overflow-y-auto`,onClick:m=>m.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100"},React.createElement("h3",{className:"text-lg font-semibold text-gray-800"},d),React.createElement("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 text-xl font-bold"},"\xD7")),React.createElement("div",{className:"p-6"},u))):null}function ie({meeting:e,setMeeting:r}){let[d,u]=N(!1),[p,m]=N(null),a=(t,i)=>r(s=>({...s,[t]:i})),o=t=>r(i=>({...i,template:{sections:t}})),b=t=>o(e.template.sections.map(i=>i.id===t?{...i,enabled:!i.enabled}:i)),h=(t,i)=>{let s=[...e.template.sections],l=s.findIndex(f=>f.id===t),c=l+i;c<0||c>=s.length||([s[l],s[c]]=[s[c],s[l]],o(s))},I=()=>{let t=prompt("Nom de la nouvelle section :");t&&o([...e.template.sections,{id:y(),name:t,enabled:!0}])},k=t=>{confirm("Supprimer cette section ?")&&o(e.template.sections.filter(i=>i.id!==t))},v=t=>{r(p?i=>({...i,agendaItems:i.agendaItems.map(s=>s.id===t.id?t:s)}):i=>({...i,agendaItems:[...i.agendaItems,{...t,id:y()}]})),u(!1),m(null)},g=t=>{confirm("Supprimer ce point ?")&&r(i=>({...i,agendaItems:i.agendaItems.filter(s=>s.id!==t)}))},n=(t,i)=>{r(s=>{let l=[...s.agendaItems],c=l.findIndex(S=>S.id===t),f=c+i;return f<0||f>=l.length?s:([l[c],l[f]]=[l[f],l[c]],{...s,agendaItems:l})})};return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 1 \u2013 Pr\xE9paration de la r\xE9union"),React.createElement(w,{variant:"ghost",size:"sm",onClick:()=>{r(t=>({...t,title:"R\xE9union d'\xE9quipe hebdomadaire \u2013 Service d'accompagnement",date:"2026-02-10",location:"Salle de r\xE9union principale",participants:"Sophie Martin, Marc Dupont, Fatima Benali, Julien Lef\xE8vre",agendaItems:R.map(i=>({...i,id:y()}))}))}},"Charger les donn\xE9es d\xE9mo")),React.createElement(C,{title:"Informations g\xE9n\xE9rales"},React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement(_,{label:"Titre de la r\\u00e9union",value:e.title,onChange:t=>a("title",t),required:!0,placeholder:"Ex : R\\u00e9union d'\\u00e9quipe hebdomadaire",className:"md:col-span-2"}),React.createElement(_,{label:"Date",type:"date",value:e.date,onChange:t=>a("date",t),required:!0}),React.createElement(_,{label:"Lieu",value:e.location,onChange:t=>a("location",t),placeholder:"Ex : Salle de r\\u00e9union"}),React.createElement(A,{label:"Participants",value:e.participants,onChange:t=>a("participants",t),rows:2,placeholder:"Noms des participants, s\\u00e9par\\u00e9s par des virgules",className:"md:col-span-2"}))),React.createElement(C,{title:"Gabarit du proc\xE8s-verbal",actions:React.createElement(w,{size:"sm",onClick:I},"+ Section")},React.createElement("p",{className:"text-sm text-gray-500 mb-4"},"Activez ou d\xE9sactivez les sections du PV. R\xE9ordonnez-les selon vos besoins."),React.createElement("div",{className:"space-y-2"},e.template.sections.map((t,i)=>React.createElement("div",{key:t.id,className:`flex items-center gap-3 px-3 py-2 rounded-lg border ${t.enabled?"bg-white border-gray-200":"bg-gray-50 border-gray-100 opacity-60"}`},React.createElement("button",{onClick:()=>b(t.id),className:`w-5 h-5 rounded flex items-center justify-center text-xs border ${t.enabled?"bg-indigo-600 border-indigo-600 text-white":"border-gray-300 bg-white"}`},t.enabled&&React.createElement("span",null,"\u2713")),React.createElement("span",{className:"flex-1 text-sm font-medium text-gray-700"},t.name),React.createElement("div",{className:"flex gap-1"},React.createElement("button",{onClick:()=>h(t.id,-1),disabled:i===0,className:"text-gray-400 hover:text-gray-600 disabled:opacity-30 text-xs px-1"},"\u2191"),React.createElement("button",{onClick:()=>h(t.id,1),disabled:i===e.template.sections.length-1,className:"text-gray-400 hover:text-gray-600 disabled:opacity-30 text-xs px-1"},"\u2193"),React.createElement("button",{onClick:()=>k(t.id),className:"text-red-400 hover:text-red-600 text-xs px-1"},"\xD7")))))),React.createElement(C,{title:"Points \xE0 l'ordre du jour",actions:React.createElement(w,{variant:"primary",size:"sm",onClick:()=>{m(null),u(!0)}},"+ Ajouter un point")},e.agendaItems.length===0?React.createElement("p",{className:"text-sm text-gray-400 text-center py-8"},"Aucun point. Ajoutez-en un ou chargez les donn\xE9es d\xE9mo."):React.createElement("div",{className:"space-y-3"},e.agendaItems.map((t,i)=>{let s=G.find(l=>l.value===t.priority)?.color||"";return React.createElement("div",{key:t.id,className:"border border-gray-200 rounded-lg p-4 hover:border-indigo-200 transition"},React.createElement("div",{className:"flex items-start justify-between gap-3"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-2 mb-1"},React.createElement("span",{className:"text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded"},"#",i+1),React.createElement("h4",{className:"font-semibold text-gray-800 text-sm"},t.title),React.createElement(E,{color:s},t.priority)),t.description&&React.createElement("p",{className:"text-sm text-gray-500 mt-1"},t.description),React.createElement("div",{className:"flex gap-4 mt-2 text-xs text-gray-400"},t.estimatedTime>0&&React.createElement("span",null,"Dur\xE9e : ",t.estimatedTime," min"),t.team&&React.createElement("span",null,"\xC9quipe : ",t.team),t.documents&&React.createElement("span",null,"Docs : ",t.documents))),React.createElement("div",{className:"flex items-center gap-1 flex-shrink-0"},React.createElement("button",{onClick:()=>n(t.id,-1),disabled:i===0,className:"text-gray-400 hover:text-gray-600 disabled:opacity-30 p-1"},"\u2191"),React.createElement("button",{onClick:()=>n(t.id,1),disabled:i===e.agendaItems.length-1,className:"text-gray-400 hover:text-gray-600 disabled:opacity-30 p-1"},"\u2193"),React.createElement("button",{onClick:()=>{m(t),u(!0)},className:"text-indigo-400 hover:text-indigo-600 p-1 text-sm"},"Modifier"),React.createElement("button",{onClick:()=>g(t.id),className:"text-red-400 hover:text-red-600 p-1 text-sm"},"Supprimer"))))})),React.createElement("div",{className:"mt-3 text-xs text-gray-400"},"Temps total estim\xE9 : ",e.agendaItems.reduce((t,i)=>t+(i.estimatedTime||0),0)," minutes")),React.createElement(M,{type:"warning"},React.createElement("strong",null,"Note m\xE9thodologique :")," La pr\xE9-structuration de l'ordre du jour peut induire un effet de cadrage sur les \xE9changes. Restez ouverts aux points \xE9mergents durant la r\xE9union."),React.createElement(K,{isOpen:d,onClose:()=>{u(!1),m(null)},title:p?"Modifier le point":"Nouveau point \xE0 l'ordre du jour"},React.createElement(re,{item:p,onSave:v,onCancel:()=>{u(!1),m(null)}})))}function re({item:e,onSave:r,onCancel:d}){let[u,p]=N(e||{title:"",description:"",estimatedTime:15,documents:"",team:"",priority:"normale"}),m=(a,o)=>p(b=>({...b,[a]:o}));return React.createElement("div",{className:"space-y-4"},React.createElement(_,{label:"Titre",value:u.title,onChange:a=>m("title",a),required:!0,placeholder:"Titre du point"}),React.createElement(A,{label:"Description / Contexte",value:u.description,onChange:a=>m("description",a),placeholder:"Contexte et enjeux"}),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement(_,{label:"Temps estim\\u00e9 (min)",type:"number",value:u.estimatedTime,onChange:a=>m("estimatedTime",parseInt(a)||0)}),React.createElement(z,{label:"Priorit\\u00e9",value:u.priority,onChange:a=>m("priority",a),options:G})),React.createElement(_,{label:"Documents associ\\u00e9s",value:u.documents,onChange:a=>m("documents",a),placeholder:"Ex : Rapport mensuel"}),React.createElement(_,{label:"\\u00c9quipe concern\\u00e9e",value:u.team,onChange:a=>m("team",a),placeholder:"Ex : \\u00c9quipe compl\\u00e8te"}),React.createElement("div",{className:"flex justify-end gap-3 pt-2"},React.createElement(w,{variant:"secondary",onClick:d},"Annuler"),React.createElement(w,{variant:"primary",onClick:()=>u.title&&r(u),disabled:!u.title},"Enregistrer")))}function ne({meeting:e,setMeeting:r}){let[d,u]=N(e.recording.duration||0),p=j(null),m=j(null),a=j([]),o=j(null),[b,h]=N(null),[I,k]=N(!1),[v,g]=N(null),n=e.recording.status==="recording",t=e.recording.status==="done";L(()=>(n?p.current=setInterval(()=>u(c=>c+1),1e3):clearInterval(p.current),()=>clearInterval(p.current)),[n]),L(()=>()=>{o.current&&o.current.getTracks().forEach(c=>c.stop()),v&&URL.revokeObjectURL(v)},[]);let i=async()=>{if(!e.rgpdConsent){alert("Veuillez accepter les conditions RGPD avant de d\xE9marrer l'enregistrement.");return}h(null);try{let c=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});o.current=c,a.current=[];let f=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm",S=new MediaRecorder(c,{mimeType:f});m.current=S,S.ondataavailable=q=>{q.data.size>0&&a.current.push(q.data)},S.start(1e3),u(0),v&&(URL.revokeObjectURL(v),g(null)),r(q=>({...q,recording:{status:"recording",duration:0,filename:""}}))}catch(c){console.error("Microphone error:",c),c.name==="NotAllowedError"?h("Acc\xE8s au microphone refus\xE9. Autorisez l'acc\xE8s dans les param\xE8tres de votre navigateur."):c.name==="NotFoundError"?h("Aucun microphone d\xE9tect\xE9. V\xE9rifiez qu'un microphone est connect\xE9."):h(`Erreur microphone : ${c.message}`)}},s=()=>{!m.current||m.current.state!=="recording"||(m.current.onstop=async()=>{o.current&&(o.current.getTracks().forEach(T=>T.stop()),o.current=null);let c=m.current.mimeType||"audio/webm",f=new Blob(a.current,{type:c}),S=c.includes("webm")?"webm":"ogg",q=`Reunion_${e.date||"sans_date"}_${Date.now()}.${S}`,W=URL.createObjectURL(f);g(W);let J="";if(x&&f.size>0){k(!0);try{let T=`${e.id}/${q}`,{data:Z,error:F}=await x.storage.from("audio-recordings").upload(T,f,{contentType:c,upsert:!0});F?console.error("Upload Storage error:",F):J=Z.path||T}catch(T){console.error("Upload failed:",T)}k(!1)}let X=f.size;r(T=>({...T,recording:{status:"done",duration:d,filename:q,filePath:J,fileSizeBytes:X}}))},m.current.stop())},l=()=>{confirm("R\xE9initialiser l'enregistrement ?")&&(v&&(URL.revokeObjectURL(v),g(null)),u(0),r(c=>({...c,recording:{status:"idle",duration:0,filename:""}})))};return React.createElement("div",{className:"space-y-6"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 2 \u2013 Enregistrement audio"),React.createElement(C,{title:"Avis RGPD \u2013 Consentement obligatoire",warning:!e.rgpdConsent},React.createElement("div",{className:"space-y-3"},React.createElement("p",{className:"text-sm text-gray-600"},"Conform\xE9ment au RGPD, l'enregistrement audio implique le traitement de donn\xE9es \xE0 caract\xE8re personnel."),React.createElement("div",{className:"bg-gray-50 rounded-lg p-4 text-xs text-gray-600 space-y-2"},React.createElement("p",null,React.createElement("strong",null,"Finalit\xE9 :")," Transcription et \xE9laboration du proc\xE8s-verbal."),React.createElement("p",null,React.createElement("strong",null,"Base l\xE9gale :")," Consentement explicite des participants (art. 6.1.a RGPD)."),React.createElement("p",null,React.createElement("strong",null,"Conservation :")," Suppression apr\xE8s validation du PV, sauf d\xE9cision contraire document\xE9e."),React.createElement("p",null,React.createElement("strong",null,"Droits :")," Acc\xE8s, rectification et suppression pour chaque participant."),React.createElement("p",null,React.createElement("strong",null,"Minimisation :")," Seules les informations strictement n\xE9cessaires seront trait\xE9es.")),React.createElement("label",{className:"flex items-center gap-3 cursor-pointer"},React.createElement("input",{type:"checkbox",checked:e.rgpdConsent,onChange:c=>r(f=>({...f,rgpdConsent:c.target.checked})),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),React.createElement("span",{className:"text-sm font-medium text-gray-700"},"Je confirme que tous les participants ont donn\xE9 leur consentement")))),b&&React.createElement(M,{type:"danger"},React.createElement("strong",null,"Erreur micro :")," ",b),React.createElement(C,{title:"Contr\xF4les d'enregistrement"},React.createElement("div",{className:"flex flex-col items-center py-8 space-y-6"},React.createElement("div",{className:"text-5xl font-mono font-light text-gray-800 tracking-wider"},U(n?d:t?e.recording.duration:0)),n&&React.createElement("div",{className:"flex items-center gap-1 h-8"},Array.from({length:30}).map((c,f)=>React.createElement("div",{key:f,className:"w-1 bg-red-400 rounded-full wave-bar",style:{animationDelay:`${f*.08}s`,minHeight:"4px"}}))),React.createElement("div",{className:"flex items-center gap-2"},n&&React.createElement("div",{className:"w-3 h-3 bg-red-500 rounded-full pulse-rec"}),I&&React.createElement("div",{className:"w-3 h-3 bg-amber-400 rounded-full animate-pulse"}),React.createElement("span",{className:`text-sm font-medium ${n?"text-red-600":t?"text-emerald-600":I?"text-amber-600":"text-gray-500"}`},n?"Enregistrement en cours...":I?"Upload vers le serveur...":t?"Enregistrement termin\xE9":"Pr\xEAt \xE0 enregistrer")),React.createElement("div",{className:"flex gap-3"},!n&&!t&&!I&&React.createElement(w,{variant:"danger",size:"lg",onClick:i,disabled:!e.rgpdConsent},"D\xE9marrer l'enregistrement"),n&&React.createElement(w,{variant:"secondary",size:"lg",onClick:s},"Arr\xEAter l'enregistrement"),t&&!I&&React.createElement(w,{variant:"secondary",onClick:l},"Nouvel enregistrement")),t&&React.createElement("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 text-sm w-full max-w-md space-y-2"},React.createElement("p",{className:"font-medium text-emerald-800"},"Fichier enregistr\xE9"),React.createElement("p",{className:"text-emerald-600"},e.recording.filename),React.createElement("p",{className:"text-emerald-600"},"Dur\xE9e : ",U(e.recording.duration)),e.recording.fileSizeBytes>0&&React.createElement("p",{className:"text-emerald-600"},"Taille : ",(e.recording.fileSizeBytes/1024/1024).toFixed(2)," Mo"),v&&React.createElement("div",{className:"mt-3"},React.createElement("p",{className:"text-xs text-gray-500 mb-1"},"R\xE9\xE9couter :"),React.createElement("audio",{controls:!0,src:v,className:"w-full"}))))),React.createElement(M,{type:"info"},React.createElement("strong",null,"Enregistrement r\xE9el :")," L'audio est captur\xE9 via le microphone de votre appareil (WebM/Opus).",x?" Le fichier est automatiquement sauvegard\xE9 sur le serveur.":" Mode hors-ligne : le fichier est conserv\xE9 localement uniquement."))}function oe({meeting:e,setMeeting:r}){let[d,u]=N("auto"),[p,m]=N(""),[a,o]=N(!1),[b,h]=N(null),I=async()=>{if(x&&e.recording.filePath){o(!0),h(null);try{let{data:s,error:l}=await x.functions.invoke("transcribe",{body:{meeting_id:e.id,audio_path:e.recording.filePath}});if(l)throw new Error(l.message||"Erreur Edge Function");if(s.error)throw new Error(s.error);if(s.segments&&s.segments.length>0){r(c=>({...c,transcription:{status:"done",segments:s.segments.map(f=>({speaker:f.speaker,text:f.text,time:f.start_time}))}})),o(!1);return}throw new Error("Aucun segment retourn\xE9 par Whisper")}catch(s){console.error("Transcription error:",s),h(`${s.message}. Vous pouvez utiliser les donn\xE9es d\xE9mo ou coller votre propre transcription.`),o(!1);return}}r(s=>({...s,transcription:{status:"done",segments:H}}))},k=()=>{confirm("Effacer la transcription ?")&&r(s=>({...s,transcription:{status:"idle",segments:[]}}))},v=()=>{let l=p.split(`
`).filter(c=>c.trim()).map(c=>{let f=c.match(/^\[?(\d{1,2}:\d{2}(?::\d{2})?)\]?\s*(.+?):\s*(.+)$/);return f?{time:f[1],speaker:f[2],text:f[3]}:{time:"",speaker:"Inconnu",text:c}});r(c=>({...c,transcription:{status:"done",segments:l}}))},g=e.transcription.status==="done",n=g?[...new Set(e.transcription.segments.map(s=>s.speaker))]:[],t={},i=["bg-blue-100 text-blue-800","bg-emerald-100 text-emerald-800","bg-purple-100 text-purple-800","bg-amber-100 text-amber-800"];return n.forEach((s,l)=>t[s]=i[l%i.length]),React.createElement("div",{className:"space-y-6"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 3 \u2013 Transcription"),b&&React.createElement(M,{type:"danger"},b),!g&&!a&&React.createElement(C,{title:"Source de la transcription"},React.createElement("div",{className:"flex gap-4 mb-4"},React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},React.createElement("input",{type:"radio",name:"tmode",checked:d==="auto",onChange:()=>u("auto"),className:"text-indigo-600"}),React.createElement("span",{className:"text-sm"},e.recording.filePath?"Transcription automatique (Whisper)":"Transcription automatique (d\xE9mo)")),React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},React.createElement("input",{type:"radio",name:"tmode",checked:d==="manual",onChange:()=>u("manual"),className:"text-indigo-600"}),React.createElement("span",{className:"text-sm"},"Coller ma propre transcription"))),d==="auto"?React.createElement("div",{className:"text-center py-6"},React.createElement("p",{className:"text-sm text-gray-500 mb-4"},e.recording.filePath?"L'audio enregistr\xE9 sera envoy\xE9 \xE0 OpenAI Whisper pour transcription automatique en fran\xE7ais.":"Aucun enregistrement r\xE9el disponible. Les donn\xE9es de d\xE9monstration seront utilis\xE9es."),React.createElement(w,{variant:"primary",onClick:I},e.recording.filePath?"Lancer la transcription Whisper":"G\xE9n\xE9rer (d\xE9mo)")):React.createElement("div",{className:"space-y-3"},React.createElement("p",{className:"text-xs text-gray-500"},"Format : [HH:MM] Locuteur : Texte (un segment par ligne)"),React.createElement(A,{value:p,onChange:m,rows:10,placeholder:"[00:00] Sophie : Bonjour \\u00e0 tous..."}),React.createElement(w,{variant:"primary",onClick:v,disabled:!p.trim()},"Importer"))),a&&React.createElement(C,null,React.createElement("div",{className:"text-center py-12 space-y-4"},React.createElement("div",{style:{width:40,height:40,border:"3px solid #e2e8f0",borderTopColor:"#4f46e5",borderRadius:"50%",animation:"spin 0.8s linear infinite",margin:"0 auto"}}),React.createElement("p",{className:"text-sm text-gray-600 font-medium"},"Transcription en cours via Whisper..."),React.createElement("p",{className:"text-xs text-gray-400"},"Cela peut prendre 30 secondes \xE0 2 minutes selon la dur\xE9e de l'enregistrement."))),g&&React.createElement(React.Fragment,null,React.createElement(C,{title:`Transcription \u2013 ${e.transcription.segments.length} segments`,actions:React.createElement(w,{size:"sm",variant:"ghost",onClick:k},"R\xE9initialiser")},React.createElement("div",{className:"flex gap-2 mb-4 flex-wrap"},React.createElement("span",{className:"text-xs text-gray-500 self-center"},"Locuteurs :"),n.map(s=>React.createElement(E,{key:s,color:t[s]},s.split(" ")[0]))),React.createElement("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2"},e.transcription.segments.map((s,l)=>React.createElement("div",{key:l,className:"flex gap-3 group"},React.createElement("div",{className:"text-xs text-gray-400 font-mono w-14 flex-shrink-0 pt-1"},s.time),React.createElement("div",{className:"flex-1"},React.createElement(E,{color:t[s.speaker]},s.speaker),React.createElement("p",{className:"text-sm text-gray-700 mt-1 leading-relaxed"},s.text)))))),React.createElement(M,{type:"warning"},React.createElement("strong",null,"Limites techniques :")," La transcription automatique comporte un taux d'erreur non n\xE9gligeable. La diarisation peut \xEAtre approximative. V\xE9rifiez attentivement avant l'analyse.")))}function le({meeting:e,setMeeting:r}){let[d,u]=N(null),[p,m]=N(!1),[a,o]=N(null),[b,h]=N({current:0,total:0}),I=async()=>{if(x&&e.id){m(!0),o(null);let g=e.agendaItems.length;h({current:0,total:g});let n=[];try{for(let t=0;t<e.agendaItems.length;t++){let i=e.agendaItems[t];h({current:t+1,total:g});try{let{data:l,error:c}=await x.functions.invoke("analyze",{body:{meeting_id:e.id,agenda_item_id:i.id,mode:"analyze"}});if(c)throw new Error(c.message||"Erreur Edge Function");if(l.error)throw new Error(l.error);if(l.analysis){n.push({id:y(),agendaItemId:i.id,shortSummary:l.analysis.short_summary||"",detailedSummary:l.analysis.detailed_summary||"",consensus:l.analysis.consensus||[],divergences:l.analysis.divergences||[],decisions:l.analysis.decisions||[],ambiguities:l.analysis.ambiguities||[],formalText:l.analysis.formal_text||""});continue}}catch(l){console.error(`Analyse error for item ${i.title}:`,l)}let s=O[t];s?n.push({...s,id:y(),agendaItemId:i.id}):n.push({id:y(),agendaItemId:i.id,shortSummary:"Analyse non disponible pour ce point.",detailedSummary:"",consensus:[],divergences:[],decisions:[],ambiguities:["Analyse non disponible"],formalText:"[Analyse non g\xE9n\xE9r\xE9e]"})}r(t=>({...t,analyses:n})),m(!1);return}catch(t){console.error("Analysis error:",t),o(`${t.message}. Vous pouvez utiliser les donn\xE9es d\xE9mo.`),m(!1);return}}let v=e.agendaItems.map((g,n)=>{let t=O[n];return t?{...t,id:y(),agendaItemId:g.id}:{id:y(),agendaItemId:g.id,shortSummary:"Analyse non disponible pour ce point.",detailedSummary:"",consensus:[],divergences:[],decisions:[],ambiguities:["Analyse non disponible"],formalText:"[Analyse non g\xE9n\xE9r\xE9e]"}});r(g=>({...g,analyses:v}))},k=e.analyses.length>0;return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 4 \u2013 Analyse IA point par point"),!k&&!p&&React.createElement(w,{variant:"primary",onClick:I,disabled:e.agendaItems.length===0||e.transcription.status!=="done"},x?"Lancer l'analyse (Claude)":"Lancer l'analyse (d\xE9mo)")),React.createElement(M,{type:"warning"},React.createElement("strong",null,"Garde-fou m\xE9thodologique :")," Aucune inf\xE9rence non explicitement mentionn\xE9e dans la transcription n'est permise. Les LLM ont tendance \xE0 halluciner des d\xE9cisions non explicites. V\xE9rifiez chaque \xE9l\xE9ment en phase de validation."),a&&React.createElement(M,{type:"danger"},a),p&&React.createElement(C,null,React.createElement("div",{className:"text-center py-12 space-y-4"},React.createElement("div",{style:{width:40,height:40,border:"3px solid #e2e8f0",borderTopColor:"#4f46e5",borderRadius:"50%",animation:"spin 0.8s linear infinite",margin:"0 auto"}}),React.createElement("p",{className:"text-sm text-gray-600 font-medium"},"Analyse en cours via Claude AI..."),React.createElement("p",{className:"text-xs text-gray-400"},"Point ",b.current," / ",b.total),React.createElement("div",{className:"w-48 mx-auto bg-gray-200 rounded-full h-2"},React.createElement("div",{className:"bg-indigo-500 h-2 rounded-full transition-all",style:{width:`${b.total>0?b.current/b.total*100:0}%`}})),React.createElement("p",{className:"text-xs text-gray-400"},"Chaque point prend 10 \xE0 30 secondes."))),!k&&!p&&React.createElement(C,null,React.createElement("div",{className:"text-center py-8 text-gray-400"},React.createElement("p",{className:"text-sm"},"L'analyse n\xE9cessite une transcription et des points \xE0 l'OJ."))),k&&e.analyses.map((v,g)=>{let n=e.agendaItems.find(i=>i.id===v.agendaItemId);if(!n)return null;let t=d===v.agendaItemId;return React.createElement(C,{key:v.id},React.createElement("div",{className:"cursor-pointer",onClick:()=>u(t?null:v.agendaItemId)},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded"},"#",g+1),React.createElement("h4",{className:"font-semibold text-gray-800"},n.title)),React.createElement("span",{className:"text-gray-400 text-lg"},t?"\u25B2":"\u25BC")),React.createElement("p",{className:"text-sm text-gray-600 mt-2"},v.shortSummary)),t&&React.createElement("div",{className:"mt-4 space-y-4 border-t border-gray-100 pt-4"},v.detailedSummary&&React.createElement("div",null,React.createElement("h5",{className:"text-sm font-semibold text-gray-700 mb-1"},"Synth\xE8se d\xE9taill\xE9e"),React.createElement("p",{className:"text-sm text-gray-600 leading-relaxed"},v.detailedSummary)),v.consensus.length>0&&React.createElement("div",null,React.createElement("h5",{className:"text-sm font-semibold text-emerald-700 mb-1"},"\xC9l\xE9ments de consensus"),React.createElement("ul",{className:"space-y-1"},v.consensus.map((i,s)=>React.createElement("li",{key:s,className:"text-sm text-gray-600 flex gap-2"},React.createElement("span",{className:"text-emerald-500 flex-shrink-0"},"\u2713"),i)))),v.divergences.length>0&&React.createElement("div",null,React.createElement("h5",{className:"text-sm font-semibold text-amber-700 mb-1"},"\xC9l\xE9ments de divergence"),React.createElement("ul",{className:"space-y-1"},v.divergences.map((i,s)=>React.createElement("li",{key:s,className:"text-sm text-gray-600 flex gap-2"},React.createElement("span",{className:"text-amber-500 flex-shrink-0"},"\u26A0"),i)))),v.decisions.length>0?React.createElement("div",null,React.createElement("h5",{className:"text-sm font-semibold text-blue-700 mb-1"},"D\xE9cisions explicites"),React.createElement("ul",{className:"space-y-1"},v.decisions.map((i,s)=>React.createElement("li",{key:s,className:"text-sm text-gray-600 flex gap-2"},React.createElement("span",{className:"text-blue-500 flex-shrink-0"},"\u2192"),i)))):React.createElement(M,{type:"info"},"Aucune d\xE9cision explicite identifi\xE9e dans la transcription pour ce point."),v.ambiguities.length>0&&React.createElement("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3"},React.createElement("h5",{className:"text-sm font-semibold text-amber-800 mb-1"},"Zones d'incertitude"),React.createElement("ul",{className:"space-y-1"},v.ambiguities.map((i,s)=>React.createElement("li",{key:s,className:"text-sm text-amber-700 flex gap-2"},React.createElement("span",{className:"flex-shrink-0"},"?"),i)))),v.formalText&&React.createElement("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4"},React.createElement("h5",{className:"text-sm font-semibold text-gray-700 mb-1"},"Reformulation administrative"),React.createElement("p",{className:"text-sm text-gray-600 italic leading-relaxed"},v.formalText))))}))}function ue({meeting:e,setMeeting:r}){let[d,u]=N(null),[p,m]=N(""),[a,o]=N(""),[b,h]=N(null),I=e.analyses.length,k=Object.values(e.validations).filter(g=>g.status==="accepted"||g.status==="modified").length,v=(g,n,t="")=>{r(i=>({...i,validations:{...i.validations,[g]:{status:n,comment:t,validatedAt:ee(),validatedBy:"Utilisateur"}}})),u(null),h(null),m(""),o("")};return React.createElement("div",{className:"space-y-6"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 5 \u2013 Validation humaine"),React.createElement(se,{value:k,max:I,label:`${k}/${I} points valid\xE9s`}),React.createElement(M,{type:"info"},React.createElement("strong",null,"Obligation \xE9thique et juridique :")," La validation humaine n'est pas une formalit\xE9. Chaque \xE9l\xE9ment produit par l'IA doit \xEAtre v\xE9rifi\xE9."),e.analyses.length===0&&React.createElement(C,null,React.createElement("p",{className:"text-sm text-gray-400 text-center py-6"},"Aucune analyse \xE0 valider.")),e.analyses.map((g,n)=>{let t=e.agendaItems.find(l=>l.id===g.agendaItemId);if(!t)return null;let i=e.validations[g.agendaItemId],s={accepted:"border-emerald-300 bg-emerald-50",modified:"border-blue-300 bg-blue-50",improved:"border-amber-300 bg-amber-50"};return React.createElement(C,{key:g.id,className:i&&s[i.status]||""},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded"},"#",n+1),React.createElement("h4",{className:"font-semibold text-gray-800 text-sm"},t.title)),i&&React.createElement(E,{color:i.status==="accepted"?"bg-emerald-100 text-emerald-700":i.status==="modified"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"},i.status==="accepted"?"Accept\xE9":i.status==="modified"?"Modifi\xE9":"Am\xE9lioration demand\xE9e")),React.createElement("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-4"},React.createElement("p",{className:"text-xs text-gray-400 mb-1"},"Texte propos\xE9 par l'IA :"),React.createElement("p",{className:"text-sm text-gray-700 leading-relaxed"},g.formalText)),i&&React.createElement("div",{className:"text-xs text-gray-500 mb-3"},"Valid\xE9 par ",i.validatedBy," le ",i.validatedAt,i.comment&&React.createElement("p",{className:"mt-1"},"Commentaire : ",i.comment)),b===g.agendaItemId&&React.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-3 space-y-3"},React.createElement(A,{label:"Texte modifi\\u00e9",value:a||g.formalText,onChange:o,rows:4}),React.createElement("div",{className:"flex gap-2"},React.createElement(w,{size:"sm",variant:"primary",onClick:()=>{r(l=>({...l,analyses:l.analyses.map(c=>c.agendaItemId===g.agendaItemId?{...c,formalText:a}:c)})),v(g.agendaItemId,"modified","Texte modifi\xE9 manuellement")}},"Enregistrer"),React.createElement(w,{size:"sm",variant:"ghost",onClick:()=>h(null)},"Annuler"))),d===g.agendaItemId&&React.createElement("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-3 space-y-3"},React.createElement(A,{label:"Instructions pour am\\u00e9lioration",value:p,onChange:m,rows:2,placeholder:"Ex : Pr\\u00e9ciser la d\\u00e9cision sur le budget..."}),React.createElement("div",{className:"flex gap-2"},React.createElement(w,{size:"sm",variant:"warning",onClick:()=>v(g.agendaItemId,"improved",p)},"Demander"),React.createElement(w,{size:"sm",variant:"ghost",onClick:()=>u(null)},"Annuler"))),React.createElement("div",{className:"flex gap-2 flex-wrap"},React.createElement(w,{size:"sm",variant:"success",onClick:()=>v(g.agendaItemId,"accepted")},"Accepter"),React.createElement(w,{size:"sm",variant:"secondary",onClick:()=>{h(g.agendaItemId),o(g.formalText),u(null)}},"Modifier"),React.createElement(w,{size:"sm",variant:"warning",onClick:()=>{u(g.agendaItemId),h(null)}},"Am\xE9lioration")))}))}function de({meeting:e,setMeeting:r}){let[d,u]=N(!1),[p,m]=N(null),[a,o]=N(!1),[b,h]=N(null),I=async()=>{if(x&&e.id){o(!0),h(null);try{let{data:t,error:i}=await x.functions.invoke("analyze",{body:{meeting_id:e.id,mode:"generate_tasks"}});if(i)throw new Error(i.message||"Erreur Edge Function");if(t.error)throw new Error(t.error);if(t.tasks&&t.tasks.length>0){let s=t.tasks.map(l=>{let c=e.agendaItems.find(f=>f.title.toLowerCase().includes((l.agenda_item_title||"").toLowerCase())||(l.agenda_item_title||"").toLowerCase().includes(f.title.toLowerCase()));return{id:y(),task:l.title||"",description:l.description||"",responsible:l.responsible||"",expectedOutput:l.expected_output||"",deadline:l.deadline||"",agendaItemId:c?.id||"",status:"non_commence"}});r(l=>({...l,tasks:s})),o(!1);return}throw new Error("Aucune t\xE2che extraite")}catch(t){console.error("Task generation error:",t),h(`${t.message}. Vous pouvez utiliser les donn\xE9es d\xE9mo ou ajouter les t\xE2ches manuellement.`),o(!1);return}}r(t=>{let i={oj1:t.agendaItems[0]?.id,oj2:t.agendaItems[1]?.id,oj3:t.agendaItems[2]?.id,oj4:t.agendaItems[3]?.id};return{...t,tasks:Y.map(s=>({...s,id:y(),agendaItemId:i[s.agendaItemId]||s.agendaItemId}))}})},k=t=>{r(p?i=>({...i,tasks:i.tasks.map(s=>s.id===t.id?t:s)}):i=>({...i,tasks:[...i.tasks,{...t,id:y()}]})),u(!1),m(null)},v=t=>{confirm("Supprimer cette t\xE2che ?")&&r(i=>({...i,tasks:i.tasks.filter(s=>s.id!==t)}))},g=(t,i)=>r(s=>({...s,tasks:s.tasks.map(l=>l.id===t?{...l,status:i}:l)})),n={total:e.tasks.length,nonCommence:e.tasks.filter(t=>t.status==="non_commence").length,enCours:e.tasks.filter(t=>t.status==="en_cours").length,termine:e.tasks.filter(t=>t.status==="termine").length,bloque:e.tasks.filter(t=>t.status==="bloque").length};return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h2",{className:"text-xl font-bold text-gray-800"},"Phase 6 \u2013 Tableau de suivi des t\xE2ches"),React.createElement("div",{className:"flex gap-2"},e.tasks.length===0&&!a&&React.createElement(w,{variant:"primary",onClick:I,disabled:e.analyses.length===0},x?"G\xE9n\xE9rer les t\xE2ches (Claude)":"G\xE9n\xE9rer les t\xE2ches (d\xE9mo)"),React.createElement(w,{variant:"secondary",onClick:()=>{m(null),u(!0)}},"+ Ajouter"))),b&&React.createElement(M,{type:"danger"},b),a&&React.createElement(C,null,React.createElement("div",{className:"text-center py-12 space-y-4"},React.createElement("div",{style:{width:40,height:40,border:"3px solid #e2e8f0",borderTopColor:"#4f46e5",borderRadius:"50%",animation:"spin 0.8s linear infinite",margin:"0 auto"}}),React.createElement("p",{className:"text-sm text-gray-600 font-medium"},"Extraction des t\xE2ches via Claude AI..."),React.createElement("p",{className:"text-xs text-gray-400"},"Analyse de la transcription pour identifier les t\xE2ches, responsables et \xE9ch\xE9ances."))),e.tasks.length>0&&React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3"},[["Total",n.total,"bg-white"],["Non commenc\xE9",n.nonCommence,"bg-gray-50"],["En cours",n.enCours,"bg-blue-50"],["Termin\xE9",n.termine,"bg-emerald-50"],["Bloqu\xE9",n.bloque,"bg-red-50"]].map(([t,i,s])=>React.createElement("div",{key:t,className:`${s} rounded-lg border border-gray-200 p-3 text-center`},React.createElement("div",{className:"text-2xl font-bold text-gray-800"},i),React.createElement("div",{className:"text-xs text-gray-500"},t)))),e.tasks.length===0?React.createElement(C,null,React.createElement("p",{className:"text-sm text-gray-400 text-center py-8"},"Aucune t\xE2che. G\xE9n\xE9rez-les ou ajoutez-en manuellement.")):React.createElement("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},React.createElement("div",{className:"overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"bg-gray-50 border-b border-gray-200"},["T\xE2che","Responsable","Produit attendu","\xC9ch\xE9ance","Point OJ","Statut",""].map(t=>React.createElement("th",{key:t,className:"text-left px-4 py-3 font-semibold text-gray-600 text-xs uppercase tracking-wider"},t)))),React.createElement("tbody",null,e.tasks.map(t=>{let i=e.agendaItems.find(l=>l.id===t.agendaItemId),s=D.find(l=>l.value===t.status)?.color||"";return React.createElement("tr",{key:t.id,className:"border-b border-gray-100 hover:bg-gray-50 transition"},React.createElement("td",{className:"px-4 py-3"},React.createElement("div",{className:"font-medium text-gray-800"},t.task),t.description&&React.createElement("div",{className:"text-xs text-gray-400 mt-0.5"},t.description)),React.createElement("td",{className:"px-4 py-3 text-gray-600"},t.responsible),React.createElement("td",{className:"px-4 py-3 text-gray-600 text-xs"},t.expectedOutput),React.createElement("td",{className:"px-4 py-3 text-gray-600 font-mono text-xs"},t.deadline),React.createElement("td",{className:"px-4 py-3"},i?React.createElement("span",{className:"text-xs text-indigo-600"},i.title.substring(0,30),"..."):"-"),React.createElement("td",{className:"px-4 py-3"},React.createElement("select",{value:t.status,onChange:l=>g(t.id,l.target.value),className:`text-xs px-2 py-1 rounded-full font-medium border-0 ${s}`},D.map(l=>React.createElement("option",{key:l.value,value:l.value},l.label)))),React.createElement("td",{className:"px-4 py-3"},React.createElement("div",{className:"flex gap-1"},React.createElement("button",{onClick:()=>{m(t),u(!0)},className:"text-indigo-500 hover:text-indigo-700 text-xs"},"Modifier"),React.createElement("button",{onClick:()=>v(t.id),className:"text-red-500 hover:text-red-700 text-xs"},"Suppr."))))}))))),e.tasks.length>0&&React.createElement(M,{type:"warning"},React.createElement("strong",null,"Analyse r\xE9flexive :")," Les t\xE2ches sont extraites automatiquement. Les LLM identifient difficilement les responsabilit\xE9s non verbalis\xE9es. Chaque assignation doit \xEAtre valid\xE9e manuellement."),React.createElement(K,{isOpen:d,onClose:()=>{u(!1),m(null)},title:p?"Modifier":"Nouvelle t\xE2che",wide:!0},React.createElement(ce,{task:p,agendaItems:e.agendaItems,onSave:k,onCancel:()=>{u(!1),m(null)}})))}function ce({task:e,agendaItems:r,onSave:d,onCancel:u}){let[p,m]=N(e||{task:"",responsible:"",description:"",expectedOutput:"",deadline:"",agendaItemId:r[0]?.id||"",status:"non_commence"}),a=(o,b)=>m(h=>({...h,[o]:b}));return React.createElement("div",{className:"space-y-4"},React.createElement(_,{label:"T\\u00e2che",value:p.task,onChange:o=>a("task",o),required:!0,placeholder:"Description"}),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement(_,{label:"Responsable(s)",value:p.responsible,onChange:o=>a("responsible",o)}),React.createElement(_,{label:"\\u00c9ch\\u00e9ance",type:"date",value:p.deadline,onChange:o=>a("deadline",o)})),React.createElement(A,{label:"Description",value:p.description,onChange:o=>a("description",o),rows:2}),React.createElement(_,{label:"Produit attendu",value:p.expectedOutput,onChange:o=>a("expectedOutput",o)}),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement(z,{label:"Point OJ li\\u00e9",value:p.agendaItemId,onChange:o=>a("agendaItemId",o),options:[{value:"",label:"-- Aucun --"},...r.map(o=>({value:o.id,label:o.title}))]}),React.createElement(z,{label:"Statut",value:p.status,onChange:o=>a("status",o),options:D})),React.createElement("div",{className:"flex justify-end gap-3 pt-2"},React.createElement(w,{variant:"secondary",onClick:u},"Annuler"),React.createElement(w,{variant:"primary",onClick:()=>p.task&&d(p),disabled:!p.task},"Enregistrer")))}function me({meeting:e,currentPhase:r,setPhase:d,onReset:u,onLoadDemo:p}){let m=a=>{if(a===0)return e.agendaItems.length>0?"done":"current";if(a===1)return e.recording.status==="done"?"done":e.recording.status==="recording"?"current":"pending";if(a===2)return e.transcription.status==="done"?"done":"pending";if(a===3)return e.analyses.length>0?"done":"pending";if(a===4){let o=e.analyses.length,b=Object.values(e.validations).filter(h=>h.status==="accepted"||h.status==="modified").length;return o>0&&b===o?"done":b>0?"partial":"pending"}return a===5&&e.tasks.length>0?"done":"pending"};return React.createElement("div",{className:"w-64 bg-slate-900 text-white flex flex-col flex-shrink-0 h-screen sticky top-0"},React.createElement("div",{className:"px-5 py-5 border-b border-slate-700"},React.createElement("h1",{className:"text-lg font-bold tracking-tight"},"GestR\xE9union"),React.createElement("p",{className:"text-xs text-slate-400 mt-0.5"},"Gestion des r\xE9unions d'\xE9quipe")),React.createElement("nav",{className:"flex-1 py-4 overflow-y-auto",style:{maxHeight:"calc(100vh - 140px)"}},React.createElement("p",{className:"px-5 text-xs text-slate-500 uppercase tracking-wider mb-3"},"Phases"),V.map(a=>{let o=m(a.id),b=r===a.id;return React.createElement("button",{key:a.id,onClick:()=>d(a.id),className:`w-full flex items-center gap-3 px-5 py-3 text-sm transition-colors ${b?"bg-indigo-600/20 text-indigo-300 border-r-2 border-indigo-400":"text-slate-300 hover:bg-slate-800 hover:text-white"}`},React.createElement("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs flex-shrink-0 ${o==="done"?"bg-emerald-500 text-white":o==="partial"?"bg-amber-500 text-white":b?"bg-indigo-500 text-white":"bg-slate-700 text-slate-400"}`},o==="done"?"\u2713":a.id+1),React.createElement("span",{className:"truncate"},a.label))})),React.createElement("div",{className:"p-4 border-t border-slate-700 space-y-2"},React.createElement("button",{onClick:p,className:"w-full text-xs text-slate-400 hover:text-indigo-300 transition py-1"},"Charger la d\xE9mo compl\xE8te"),React.createElement("button",{onClick:u,className:"w-full text-xs text-slate-400 hover:text-red-300 transition py-1"},"R\xE9initialiser")))}function pe(){let[e,r]=N($),[d,u]=N(0),[p,m]=N(!0),[a,o]=N(!1),[b,h]=N(!1),[I,k]=N(null),v=j(null),g=j(!0);L(()=>{let s=!1;async function l(){try{if(x){let c=await B.loadLatestMeeting();s||(c&&(r(c),u(c.currentPhase||0)),h(!0))}else try{let c=localStorage.getItem(P);if(c){let f=JSON.parse(c);f&&f.id&&!s&&(r(f),u(f.currentPhase||0))}}catch{}}catch(c){console.error("Erreur de chargement Supabase:",c),s||k("Mode hors-ligne : impossible de joindre la base de donn\xE9es.");try{let f=localStorage.getItem(P);if(f){let S=JSON.parse(f);S&&S.id&&!s&&(r(S),u(S.currentPhase||0))}}catch{}}finally{s||(m(!1),g.current=!1)}}return l(),()=>{s=!0}},[]),L(()=>{if(!(g.current||p)){try{localStorage.setItem(P,JSON.stringify({...e,currentPhase:d}))}catch{}return x&&(clearTimeout(v.current),v.current=setTimeout(async()=>{try{o(!0),await B.saveMeeting(e,d),h(!0),k(null)}catch(s){console.error("Erreur de sauvegarde Supabase:",s),k("Erreur de sauvegarde. Les donn\xE9es sont conserv\xE9es localement.")}finally{o(!1)}},2e3)),()=>clearTimeout(v.current)}},[e,d,p]);let n=()=>{confirm("R\xE9initialiser toutes les donn\xE9es ?")&&(r($()),u(0))},t=()=>{let s=R.map(c=>({...c,id:y()})),l={};R.forEach((c,f)=>{l[c.id]=s[f].id}),r(c=>({...c,title:"R\xE9union d'\xE9quipe hebdomadaire \u2013 Service d'accompagnement",date:"2026-02-10",location:"Salle de r\xE9union principale",participants:"Sophie Martin, Marc Dupont, Fatima Benali, Julien Lef\xE8vre",agendaItems:s,recording:{status:"done",duration:470,filename:"Reunion_2026-02-10_demo.mp3"},rgpdConsent:!0,transcription:{status:"done",segments:H},analyses:O.map((f,S)=>({...f,id:y(),agendaItemId:s[S]?.id||null})),tasks:Y.map(f=>({...f,id:y(),agendaItemId:l[f.agendaItemId]||f.agendaItemId}))}))};if(p)return React.createElement("div",{className:"flex items-center justify-center min-h-screen bg-gray-50"},React.createElement("div",{className:"text-center"},React.createElement("div",{style:{width:40,height:40,border:"3px solid #e2e8f0",borderTopColor:"#4f46e5",borderRadius:"50%",animation:"spin 0.8s linear infinite",margin:"0 auto 16px"}}),React.createElement("p",{className:"text-gray-500 text-sm"},"Chargement des donn\xE9es...")));let i={0:React.createElement(ie,{meeting:e,setMeeting:r}),1:React.createElement(ne,{meeting:e,setMeeting:r}),2:React.createElement(oe,{meeting:e,setMeeting:r}),3:React.createElement(le,{meeting:e,setMeeting:r}),4:React.createElement(ue,{meeting:e,setMeeting:r}),5:React.createElement(de,{meeting:e,setMeeting:r})};return React.createElement("div",{className:"flex min-h-screen"},React.createElement(me,{meeting:e,currentPhase:d,setPhase:u,onReset:n,onLoadDemo:t}),React.createElement("main",{className:"flex-1 min-h-screen"},React.createElement("div",{className:"bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between sticky top-0 z-10"},React.createElement("div",null,React.createElement("h2",{className:"text-sm font-semibold text-gray-800"},e.title||"Nouvelle r\xE9union"),React.createElement("p",{className:"text-xs text-gray-400"},e.date?Q(e.date):"",e.location?` \u2013 ${e.location}`:"")),React.createElement("div",{className:"flex items-center gap-3"},a&&React.createElement("span",{className:"text-xs text-gray-400 flex items-center gap-1"},React.createElement("span",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),"Sauvegarde..."),!a&&b&&!I&&React.createElement("span",{className:"text-xs text-emerald-500 flex items-center gap-1"},React.createElement("span",{className:"w-2 h-2 bg-emerald-400 rounded-full"}),"Synchronis\xE9"),I&&React.createElement("span",{className:"text-xs text-red-500 flex items-center gap-1",title:I},React.createElement("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),"Hors-ligne"),React.createElement("div",{className:"w-px h-6 bg-gray-200 mx-1"}),d>0&&React.createElement(w,{size:"sm",variant:"ghost",onClick:()=>u(s=>s-1)},"\u2190 Pr\xE9c\xE9dent"),d<5&&React.createElement(w,{size:"sm",variant:"primary",onClick:()=>u(s=>s+1)},"Suivant \u2192"))),I&&React.createElement("div",{className:"bg-amber-50 border-b border-amber-200 px-8 py-2"},React.createElement("p",{className:"text-xs text-amber-700"},I)),React.createElement("div",{className:"p-8 max-w-5xl"},i[d])))}var ge=ReactDOM.createRoot(document.getElementById("root"));ge.render(React.createElement(pe,null));})();
</script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/gestreunion/sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>